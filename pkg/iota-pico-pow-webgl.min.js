!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@iota-pico/crypto/dist/error/cryptoError"),require("@iota-pico/core/dist/helpers/objectHelper"),require("@iota-pico/data/dist/data/trits"),require("@iota-pico/crypto/dist/factories/spongeFactory"),require("@iota-pico/data/dist/data/trytes"),require("@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"),require("@iota-pico/core/dist/helpers/numberHelper")):"function"==typeof define&&define.amd?define("@iota-pico/pow-webgl",["@iota-pico/crypto/dist/error/cryptoError","@iota-pico/core/dist/helpers/objectHelper","@iota-pico/data/dist/data/trits","@iota-pico/crypto/dist/factories/spongeFactory","@iota-pico/data/dist/data/trytes","@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase","@iota-pico/core/dist/helpers/numberHelper"],e):"object"==typeof exports?exports["@iota-pico/pow-webgl"]=e(require("@iota-pico/crypto/dist/error/cryptoError"),require("@iota-pico/core/dist/helpers/objectHelper"),require("@iota-pico/data/dist/data/trits"),require("@iota-pico/crypto/dist/factories/spongeFactory"),require("@iota-pico/data/dist/data/trytes"),require("@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"),require("@iota-pico/core/dist/helpers/numberHelper")):t.IotaPicoPowWebgl=e(t["@iota-pico/crypto/dist/error/cryptoError"],t["@iota-pico/core/dist/helpers/objectHelper"],t["@iota-pico/data/dist/data/trits"],t["@iota-pico/crypto/dist/factories/spongeFactory"],t["@iota-pico/data/dist/data/trytes"],t["@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"],t["@iota-pico/core/dist/helpers/numberHelper"])}("undefined"!=typeof self?self:this,function(t,e,r,n,i,o,a){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=26)}([function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e,r){t.exports=r(24)},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.ready=0]="ready",t[t.searching=1]="searching",t[t.interrupted=-1]="interrupted"}(e.PearlDiverState||(e.PearlDiverState={}))},function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(e,"__esModule",{value:!0});var i=r(1),o=r(0),a=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,r){r&&n(t,r)}(t,0,[{key:"createContext",value:function(t){var e=t.getWindow();if(i.ObjectHelper.isEmpty(e)||void 0===e)throw new o.CryptoError("window is not available, you must be running in an environment with WebGL.");var r=t.getDocument(e);if(i.ObjectHelper.isEmpty(r))throw new o.CryptoError("window.document is not available, you must be running in an environment with WebGL.");var n=t.getCanvas(r);if(i.ObjectHelper.isEmpty(n))throw new o.CryptoError("The HTML5 <canvas> element is not available in your browser.",{userAgent:e.navigator.userAgent});var a=t.getWebGL(n);if(i.ObjectHelper.isEmpty(a))throw new o.CryptoError("Can not create a WebGL context on a <canvas> element.",{userAgent:e.navigator.userAgent});return a}},{key:"createBuffer",value:function(t,e,r,n){var i=t.createBuffer();return t.bindBuffer(n||t.ARRAY_BUFFER,i),t.bufferData(n||t.ARRAY_BUFFER,new(r||Float32Array)(e),t.STATIC_DRAW),i}},{key:"createTexture",value:function(t,e,r){var n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32I,r.x,r.y,0,t.RGBA_INTEGER,t.INT,e),t.bindTexture(t.TEXTURE_2D,null),n}},{key:"frameBufferSetTexture",value:function(t,e,r){if(t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new o.CryptoError("Error attaching float texture to framebuffer. Your device is probably incompatible.")}}]),t}();e.WebGLHelper=a},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="#version 300 es\nlayout(location = 0) in vec2 position;\nlayout(location = 1) in vec2 texture;\nout vec2 pos;\n\nvoid main(void) {\n  pos = texture;\n  gl_Position = vec4(position.xy, 0.0, 1.0);\n}"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp isampler2D;\nuniform isampler2D u_texture;\nin vec2 pos;\nout ivec4 color;\n//out int isFinished;\n\nvec2 size;\nivec2 my_coord;\n\nvoid init(void) {\n  //size = vec2(textureSize(u_texture, 0) - 1);\n  size = vec2(textureSize(u_texture, 0));\n  my_coord = ivec2(pos * size);\n}\n\nivec4 read(void) {\n  return texture(u_texture, pos);\n}\n\nivec4 read_at(ivec2 coord) {\n  return texelFetch(u_texture, coord, 0);\n}\n\nvoid commit(ivec4 val) {\n  color = val;\n}\n"},function(t,e,r){"use strict";function n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var i=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var o=r(0),a=i(r(6)),c=i(r(5)),u=r(4),s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}return function(t,e,r){e&&n(t.prototype,e)}(t,[{key:"initialize",value:function(t,e,r){this._context=u.WebGLHelper.createContext(t),this._dimensions={x:e,y:0};var n=.5*Math.pow(this._context.MAX_TEXTURE_SIZE,2),i=Math.floor(n/this._dimensions.x/r)*this._dimensions.x*r;this._dimensions.y=i/this._dimensions.x/r,this._programs=new Map,this._ipt={data:new Int32Array(i),length:i},this._buffers={position:u.WebGLHelper.createBuffer(this._context,[-1,-1,1,-1,1,1,-1,1]),texture:u.WebGLHelper.createBuffer(this._context,[0,0,1,0,1,1,0,1]),index:u.WebGLHelper.createBuffer(this._context,[1,2,0,3,0,2],Uint16Array,this._context.ELEMENT_ARRAY_BUFFER)},this._attrib={position:0,texture:1},this._vertexArray=this._context.createVertexArray(),this._context.bindVertexArray(this._vertexArray),this.bindBuffers(),this._context.bindVertexArray(null),this.createVertexShader(),this._frameBuffer=this._context.createFramebuffer(),this._texture0=u.WebGLHelper.createTexture(this._context,this._ipt.data,this._dimensions),this._texture1=u.WebGLHelper.createTexture(this._context,new Int32Array(i),this._dimensions)}},{key:"getDimensions",value:function(){return this._dimensions}},{key:"getIpt",value:function(){return this._ipt}},{key:"addProgram",value:function(t,e){var r=this.createFragmentShader(e),n=this._context.createProgram();this._context.attachShader(n,this._vertexShader),this._context.attachShader(n,r),this._context.bindAttribLocation(n,this._attrib.position,"position"),this._context.bindAttribLocation(n,this._attrib.texture,"texture"),this._context.linkProgram(n);for(var i=new Map,o=arguments.length,a=new Array(o>2?o-2:0),c=2;c<o;c++)a[c-2]=arguments[c];for(var u=0;u<a.length;u++){var s=a[u];i.set(s,this._context.getUniformLocation(n,s))}this._programs.set(t,{program:n,uniformVars:i})}},{key:"runProgram",value:function(t,e){var r=this._programs.get(t),n=r.program;if(!this._context.getProgramParameter(n,this._context.LINK_STATUS))throw new o.CryptoError("Failed to link GLSL program code");var i=r.uniformVars,a=this._context.getUniformLocation(n,"u_texture");this._context.useProgram(n);for(var c=e,s=arguments.length,f=new Array(s>2?s-2:0),h=2;h<s;h++)f[h-2]=arguments[h];for(;c-- >0;){this._context.bindTexture(this._context.TEXTURE_2D,this._texture0),this._context.activeTexture(this._context.TEXTURE0),this._context.uniform1i(a,0),this._context.viewport(0,0,this._dimensions.x,this._dimensions.y),u.WebGLHelper.frameBufferSetTexture(this._context,this._frameBuffer,this._texture1),this._context.bindVertexArray(this._vertexArray);for(var _=0;_<f.length;_++){var l=f[_];this._context.uniform1i(i.get(l.name),l.value)}this._context.drawElements(this._context.TRIANGLES,6,this._context.UNSIGNED_SHORT,0);var d=this._texture0;this._texture0=this._texture1,this._texture1=d}this.finishRun()}},{key:"readData",value:function(t,e,r,n){return this._context.bindFramebuffer(this._context.FRAMEBUFFER,this._frameBuffer),this._context.readPixels(t,e,r,n,this._context.RGBA_INTEGER,this._context.INT,this._ipt.data),this._context.bindFramebuffer(this._context.FRAMEBUFFER,null),this._ipt.data.subarray(0,this._ipt.length)}},{key:"writeData",value:function(t){this._context.bindTexture(this._context.TEXTURE_2D,this._texture0),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA32I,this._dimensions.x,this._dimensions.y,0,this._context.RGBA_INTEGER,this._context.INT,t),this._context.bindTexture(this._context.TEXTURE_2D,null)}},{key:"bindBuffers",value:function(){this._context.bindBuffer(this._context.ARRAY_BUFFER,this._buffers.texture),this._context.enableVertexAttribArray(this._attrib.texture),this._context.vertexAttribPointer(this._attrib.texture,2,this._context.FLOAT,!1,0,0),this._context.bindBuffer(this._context.ARRAY_BUFFER,this._buffers.position),this._context.enableVertexAttribArray(this._attrib.position),this._context.vertexAttribPointer(this._attrib.position,2,this._context.FLOAT,!1,0,0),this._context.bindBuffer(this._context.ELEMENT_ARRAY_BUFFER,this._buffers.index)}},{key:"createVertexShader",value:function(){if(this._vertexShader=this._context.createShader(this._context.VERTEX_SHADER),this._context.shaderSource(this._vertexShader,c.default),this._context.compileShader(this._vertexShader),!this._context.getShaderParameter(this._vertexShader,this._context.COMPILE_STATUS))throw new o.CryptoError("Could not build vertex shader.\n\n--- CODE DUMP ---".concat(c.default,"\n\n--- ERROR LOG ---\n").concat(this._context.getShaderInfoLog(this._vertexShader)))}},{key:"createFragmentShader",value:function(t){var e=this._context.createShader(this._context.FRAGMENT_SHADER);if(this._context.shaderSource(e,a.default+t),this._context.compileShader(e),!this._context.getShaderParameter(e,this._context.COMPILE_STATUS)){for(var r=t.split("\n"),n="Could not build fragment shader.\n\n------------------ KERNEL CODE DUMP ------------------\n",i=0;i<r.length;i++)n+="".concat(a.default.split("\n").length+i,"> ").concat(r[i],"\n");throw n+="\n--------------------- ERROR  LOG ---------------------\n".concat(this._context.getShaderInfoLog(e)),new o.CryptoError(n)}return e}},{key:"finishRun",value:function(){this._context.bindVertexArray(null),this._context.bindTexture(this._context.TEXTURE_2D,null),this._context.bindFramebuffer(this._context.FRAMEBUFFER,null)}}]),t}();e.WebGLWorker=s},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nivec2 twist() {\n  int alpha, beta, gamma, delta;\n  ivec4 v1, v2;\n  int j = my_coord.x;\n\n  v1 = read_at(ivec2(j == 0? 0:(((j - 1)%2)+1)*HALF_LENGTH - ((j-1)>>1), my_coord.y));\n  v2 = read_at(ivec2(((j%2)+1)*HALF_LENGTH - ((j)>>1), my_coord.y));\n  alpha = v1.b;\n  beta = v1.a;\n  gamma = v2.a;\n  delta = (alpha | (~gamma)) & (v2.b ^ beta);//v2.b === state_low[t2]\n\n  return ivec2(~delta, (alpha ^ gamma) | delta);\n}\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x < STATE_LENGTH)\n    my_vec.ba = twist();\n  commit(my_vec);\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nuniform int gr_offset;\nivec4 offset() {\n  if(my_coord.x >= HASH_LENGTH / 3 && my_coord.x < HASH_LENGTH / 3 * 2 ) {\n    ivec4 my_vec;\n    my_vec.rg = get_sum_to_index(HASH_LENGTH / 3, HASH_LENGTH / 3 * 2, my_coord.y + gr_offset, 0);\n    return my_vec;\n  } else {\n    return read_at(ivec2(my_coord.x,0));\n  }\n}\nvoid main() {\n  init();\n  commit(offset());\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x >= INCREMENT_START && my_coord.x < HASH_LENGTH ) {\n    my_vec.rg = get_sum_to_index(INCREMENT_START, HASH_LENGTH, 1, my_coord.y);\n  }\n  if(my_coord.x == STATE_LENGTH ) {\n    my_vec.rg = ivec2(0);\n  }\n  my_vec.ba = my_vec.rg;\n  commit(my_vec);\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\n#define HASH_LENGTH 243\n#define NUMBER_OF_ROUNDS 81\n#define INCREMENT_START HASH_LENGTH - 64\n#define STATE_LENGTH 3 * HASH_LENGTH\n#define HALF_LENGTH 364\n#define HIGH_BITS 0xFFFFFFFF\n#define LOW_BITS 0x00000000\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.y == 0 && my_coord.x == STATE_LENGTH) {\n    my_vec.g = check(my_vec.b, my_vec.r);\n  }\n  if(my_coord.y == 0 && my_coord.x < HASH_LENGTH) {\n    ivec4 info_vec = read_at(ivec2(STATE_LENGTH, 0));\n    int nonce_probe = info_vec.a;\n    int row = info_vec.b;\n    ivec4 hash_vec = read_at(ivec2(my_coord.x, row));\n    my_vec.a = (hash_vec.r & nonce_probe) == 0? 1 : ((hash_vec.g & nonce_probe) == 0? -1 : 0);\n  }\n  commit(my_vec);\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nuniform int minWeightMagnitude;\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x == STATE_LENGTH) {\n    my_vec.r = minWeightMagnitude;\n    my_vec.a = check(my_coord.y, minWeightMagnitude);\n  }\n  commit(my_vec);\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nint check(int row, int min_weight_magnitude) {\n  int nonce_probe, i;\n  ivec2 r_texel;\n  nonce_probe = HIGH_BITS;\n  for(i = min_weight_magnitude; i-- > 0; ) {\n    r_texel = read_at(ivec2(HASH_LENGTH - 1 - i, row)).ba;\n    nonce_probe &= ~(r_texel.s ^ r_texel.t);\n    if(nonce_probe == 0) break;\n  }\n  return nonce_probe;\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  int i;\n  if(my_coord.x == STATE_LENGTH && my_coord.y == 0) {\n    my_vec.b = 0;\n    if(my_vec.a == 0) {\n      ivec4 read_vec;\n      my_vec.b = -1;\n      for(i = 1; i < int(size.y); i++) {\n        read_vec = read_at( ivec2( STATE_LENGTH, i));\n        if(read_vec.a != 0) {\n          my_vec.a = read_vec.a;\n          my_vec.b = i;\n          break;\n        }\n      }\n    }\n  }\n  commit(my_vec);\n}\n"},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nint sum (int a, int b) {\n  int my_sum = a + b;\n  return my_sum == 2 ? -1 : (my_sum == -2) ? 1 : my_sum;\n}\nint cons (int a, int b) {\n  return (a == 1 && b == 1)? 1 : (a == -1 && b == -1) ? -1 : 0;\n}\nint any_t (int a, int b) {\n  int my_any = a + b;\n  return my_any == 0 ? 0 : (my_any > 0) ? 1 : -1;\n}\nivec2 full_adder(int a, int b, int c) {\n  int c_a, c_b, sum_ab, c_s;\n\n  c_a    = cons(a,b);\n  sum_ab = sum(a,b);\n  c_b    = cons(sum_ab,c);\n  c_s    = any_t(c_a, c_b);\n\n  return ivec2(sum(sum_ab, c), c_s);\n}\nivec2 get_sum_to_index(int from, int to, int number_to_add, int row) {\n  int trit_to_add, trit_at_index, pow, carry, num_carry;\n  ivec2 read_in, sum_out, out_trit;\n  pow = 1;\n  carry = 0;\n  num_carry = 0;\n\n  for(int i = from; i < to; i++) {\n    //if(trit_to_add == 0 && sum_out.t == 0) continue;\n\n    read_in = read_at ( ivec2 (i, row)).rg;\n\n    trit_to_add = ((number_to_add / pow) % 3) + num_carry;\n    num_carry = trit_to_add > 1 ? 1 : 0;\n    trit_to_add = (trit_to_add == 2 ? -1 : (trit_to_add == 3 ? 0 : trit_to_add));\n\n    sum_out = full_adder(\n      (read_in.s == LOW_BITS ? 1 : read_in.t == LOW_BITS? -1 : 0),\n      trit_to_add,\n      carry\n    );\n\n    if(my_coord.x == i) break;\n    carry = sum_out.t;\n    pow *=3;\n  }\n  if(sum_out.s == 0) {\n    return ivec2(HIGH_BITS);\n  } else if (sum_out.s == 1) {\n    return ivec2(LOW_BITS, HIGH_BITS);\n  } else {\n    return ivec2(HIGH_BITS, LOW_BITS);\n  }\n}\n"},function(t,e){t.exports=r},function(t,e){t.exports=n},function(t,e,r){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(r(2));function i(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t,e){try{var r=o[t](e),a=r.value}catch(t){return void i(t)}r.done?n(a):Promise.resolve(a).then(c,u)}function c(t){a("next",t)}function u(t){a("throw",t)}c()})}}function o(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var a=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var c=r(1),u=r(18),s=r(17),f=a(r(16)),h=a(r(15)),_=a(r(14)),l=a(r(13)),d=a(r(12)),p=a(r(11)),y=a(r(10)),v=a(r(9)),m=a(r(8)),b=r(7),g=r(3),x=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this._webGLWorker=new b.WebGLWorker;var r=u.SpongeFactory.instance().create("curl");this._hashLength=r.getConstant("HASH_LENGTH"),this._stateLength=r.getConstant("STATE_LENGTH"),this._numberRounds=r.getConstant("NUMBER_OF_ROUNDS"),this._transactionLength=33*this._hashLength,this._nonceLength=this._hashLength/3,this._nonceStart=this._hashLength-this._nonceLength,this._webGLWorker.initialize(e,this._stateLength+1,t.TEXEL_SIZE),this._currentBuffer=this._webGLWorker.getIpt().data,this._webGLWorker.addProgram("init",p.default+f.default+v.default,"gr_offset"),this._webGLWorker.addProgram("increment",p.default+f.default+y.default),this._webGLWorker.addProgram("twist",p.default+m.default),this._webGLWorker.addProgram("check",p.default+_.default+l.default,"minWeightMagnitude"),this._webGLWorker.addProgram("col_check",p.default+h.default),this._webGLWorker.addProgram("finalize",p.default+_.default+d.default),this._state=g.PearlDiverState.ready,this._queue=[]}return function(t,e,r){e&&o(t.prototype,e),r&&o(t,r)}(t,[{key:"searchWithTrytes",value:function(){var t=i(n.default.mark(function t(e,r){var i;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.prepare(e),t.abrupt("return",this.search(i,r));case 2:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"prepare",value:function(t){var e=u.SpongeFactory.instance().create("curl");e.initialize();var r=s.Trits.fromTrytes(t).toArray();e.absorb(r,0,this._transactionLength-this._hashLength);var n=e.getState();return r.slice(this._transactionLength-this._hashLength,this._transactionLength).forEach(function(t,e){n[e]=t}),this.searchToPair(n)}},{key:"search",value:function(){var t=i(n.default.mark(function t(e,r){var i=this;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,n){i._queue.push({states:e,minWeightMagnitude:r,callback:t}),i._state===g.PearlDiverState.ready&&i.searchDoNext()}));case 1:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()},{key:"searchToPair",value:function(e){var r={low:new Int32Array(this._stateLength),high:new Int32Array(this._stateLength)};return e.forEach(function(e,n){switch(e){case 0:r.low[n]=t.HIGH_BITS,r.high[n]=t.HIGH_BITS;break;case 1:r.low[n]=t.LOW_BITS,r.high[n]=t.HIGH_BITS;break;default:r.low[n]=t.HIGH_BITS,r.high[n]=t.LOW_BITS}}),this.searchOffset(r,this._nonceStart),r}},{key:"searchOffset",value:function(e,r){e.low[r+0]=t.LOW_0,e.low[r+1]=t.LOW_1,e.low[r+2]=t.LOW_2,e.low[r+3]=t.LOW_3,e.high[r+0]=t.HIGH_0,e.high[r+1]=t.HIGH_1,e.high[r+2]=t.HIGH_2,e.high[r+3]=t.HIGH_3}},{key:"searchDoNext",value:function(){var t=this._queue.shift();c.ObjectHelper.isEmpty(t)?this._state=g.PearlDiverState.ready:(this._state=g.PearlDiverState.searching,this.webGLFindNonce(t))}},{key:"webGLFindNonce",value:function(t){var e=this;this.webGLWriteBuffers(t.states),this._webGLWorker.writeData(this._currentBuffer),this._webGLWorker.runProgram("init",1,{name:"gr_offset",value:0}),setTimeout(function(){return e.webGLSearch(t)},1)}},{key:"webGLWriteBuffers",value:function(e){for(var r=0;r<this._stateLength;r++)this._currentBuffer[r*t.TEXEL_SIZE]=e.low[r],this._currentBuffer[r*t.TEXEL_SIZE+1]=e.high[r],this._currentBuffer[r*t.TEXEL_SIZE+2]=e.low[r],this._currentBuffer[r*t.TEXEL_SIZE+3]=e.high[r]}},{key:"webGLSearch",value:function(t){var e=this;if(this._webGLWorker.runProgram("increment",1),this._webGLWorker.runProgram("twist",this._numberRounds),this._webGLWorker.runProgram("check",1,{name:"minWeightMagnitude",value:t.minWeightMagnitude}),this._webGLWorker.runProgram("col_check",1),-1===this._webGLWorker.readData(this._stateLength,0,1,1)[2])setTimeout(function(){return e.webGLSearch(t)},10);else{this._webGLWorker.runProgram("finalize",1);var r=this._webGLWorker.readData(0,0,this._webGLWorker.getDimensions().x,1).reduce(this.pack(4),[]).slice(0,this._hashLength).map(function(t){return t[3]});t.callback(s.Trits.fromNumberArray(r).toTrytes()),this.searchDoNext()}}},{key:"pack",value:function(t){return function(e,r,n){return(n%t==0?e.push([r]):e[e.length-1].push(r))&&e}}}],[{key:"initialize",value:function(e){t.instance||(t.instance=new t(e))}},{key:"closedown",value:function(){t.instance&&(t.instance=void 0)}}]),t}();x.TEXEL_SIZE=4,x.LOW_BITS=0,x.HIGH_BITS=-1,x.LOW_0=3681400539,x.LOW_1=4059626622,x.LOW_2=2147475471,x.LOW_3=4290772992,x.HIGH_0=3067833782,x.HIGH_1=2412241905,x.HIGH_2=4290781183,x.HIGH_3=4194303,e.PearlDiver=x},function(t,e){t.exports=i},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e){!function(e){"use strict";var r,n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",u=o.toStringTag||"@@toStringTag",s="object"==typeof t,f=e.regeneratorRuntime;if(f)s&&(t.exports=f);else{(f=e.regeneratorRuntime=s?t.exports:{}).wrap=g;var h="suspendedStart",_="suspendedYield",l="executing",d="completed",p={},y={};y[a]=function(){return this};var v=Object.getPrototypeOf,m=v&&v(v(A([])));m&&m!==n&&i.call(m,a)&&(y=m);var b=T.prototype=E.prototype=Object.create(y);w.prototype=b.constructor=T,T.constructor=w,T[u]=w.displayName="GeneratorFunction",f.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===w||"GeneratorFunction"===(e.displayName||e.name))},f.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,T):(t.__proto__=T,u in t||(t[u]="GeneratorFunction")),t.prototype=Object.create(b),t},f.awrap=function(t){return{__await:t}},L(S.prototype),S.prototype[c]=function(){return this},f.AsyncIterator=S,f.async=function(t,e,r,n){var i=new S(g(t,e,r,n));return f.isGeneratorFunction(e)?i:i.next().then(function(t){return t.done?t.value:i.next()})},L(b),b[u]="Generator",b[a]=function(){return this},b.toString=function(){return"[object Generator]"},f.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},f.values=A,R.prototype={constructor:R,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=r,this.done=!1,this.delegate=null,this.method="next",this.arg=r,this.tryEntries.forEach(O),!t)for(var e in this)"t"===e.charAt(0)&&i.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=r)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,i){return c.type="throw",c.arg=t,e.next=n,i&&(e.method="next",e.arg=r),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var a=this.tryEntries[o],c=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var u=i.call(a,"catchLoc"),s=i.call(a,"finallyLoc");if(u&&s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc&&(o=null);var a=o?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,p):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),O(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;O(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:A(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=r),p}}}function g(t,e,r,n){var i=e&&e.prototype instanceof E?e:E,o=Object.create(i.prototype),a=new R(n||[]);return o._invoke=function(t,e,r){var n=h;return function(i,o){if(n===l)throw new Error("Generator is already running");if(n===d){if("throw"===i)throw o;return P()}for(r.method=i,r.arg=o;;){var a=r.delegate;if(a){var c=H(a,r);if(c){if(c===p)continue;return c}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===h)throw n=d,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=l;var u=x(t,e,r);if("normal"===u.type){if(n=r.done?d:_,u.arg===p)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n=d,r.method="throw",r.arg=u.arg)}}}(t,r,a),o}function x(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}function E(){}function w(){}function T(){}function L(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function S(t){var e;this._invoke=function(r,n){function o(){return new Promise(function(e,o){!function e(r,n,o,a){var c=x(t[r],t,n);if("throw"!==c.type){var u=c.arg,s=u.value;return s&&"object"==typeof s&&i.call(s,"__await")?Promise.resolve(s.__await).then(function(t){e("next",t,o,a)},function(t){e("throw",t,o,a)}):Promise.resolve(s).then(function(t){u.value=t,o(u)},a)}a(c.arg)}(r,n,e,o)})}return e=e?e.then(o,o):o()}}function H(t,e){var n=t.iterator[e.method];if(n===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=r,H(t,e),"throw"===e.method))return p;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var i=x(n,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,p;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=r),e.delegate=null,p):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,p)}function G(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function O(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function R(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(G,this),this.reset(!0)}function A(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,o=function e(){for(;++n<t.length;)if(i.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=r,e.done=!0,e};return o.next=o}}return{next:P}}function P(){return{value:r,done:!0}}}(function(){return this}()||Function("return this")())},function(t,e,r){var n=function(){return this}()||Function("return this")(),i=n.regeneratorRuntime&&Object.getOwnPropertyNames(n).indexOf("regeneratorRuntime")>=0,o=i&&n.regeneratorRuntime;if(n.regeneratorRuntime=void 0,t.exports=r(23),i)n.regeneratorRuntime=o;else try{delete n.regeneratorRuntime}catch(t){n.regeneratorRuntime=void 0}},function(t,e,r){"use strict";var n=function(t){return t&&t.__esModule?t:{default:t}}(r(2));function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function o(t){return function(){var e=this,r=arguments;return new Promise(function(n,i){var o=t.apply(e,r);function a(t,e){try{var r=o[t](e),a=r.value}catch(t){return void i(t)}r.done?n(a):Promise.resolve(a).then(c,u)}function c(t){a("next",t)}function u(t){a("throw",t)}c()})}}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function c(t,e,r){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,r){var n=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=u(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(r):i.value}})(t,e,r||t)}function u(t){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function s(t,e){return(s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}Object.defineProperty(e,"__esModule",{value:!0});var f=r(22),h=r(1),_=r(0),l=r(21),d=r(20),p=r(19),y=function(t){function e(t,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),n=function(t,e){return!e||"object"!==i(e)&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}(this,u(e).call(this,r)),h.ObjectHelper.isEmpty(t)?n._webGLPlatform={getWindow:function(){return window},getDocument:function(t){return t.document},getCanvas:function(t){return t.createElement("canvas")},getWebGL:function(t){return t.getContext("webgl2",{alpha:!1,antialias:!1})}}:n._webGLPlatform=t,n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&s(t,e)}(e,l.ProofOfWorkBase),function(t,e,r){e&&a(t.prototype,e)}(e,[{key:"initialize",value:function(){var t=o(n.default.mark(function t(){var r=this;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c(u(e.prototype),"initialize",this).call(this);case 2:return t.abrupt("return",new Promise(function(t,e){try{p.PearlDiver.initialize(r._webGLPlatform),r._isInitialized=!0,t()}catch(t){e(t)}}));case 3:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"singlePow",value:function(){var t=o(n.default.mark(function t(e,r){var i,o,a;return n.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this._isInitialized){t.next=2;break}throw new _.CryptoError("WebGL is not initialized, have you called initialize");case 2:if(h.ObjectHelper.isType(e,d.Trytes)){t.next=4;break}throw new _.CryptoError("The trytes must be an object of type Trytes");case 4:if(f.NumberHelper.isInteger(r)&&!(r<=0)){t.next=6;break}throw new _.CryptoError("The minWeightMagnitude must be > 0");case 6:return t.next=8,p.PearlDiver.instance.searchWithTrytes(e,r);case 8:return i=t.sent,o=e.toString(),a=i.toString(),t.abrupt("return",d.Trytes.fromString(o.substr(0,o.length-a.length).concat(a)));case 12:case"end":return t.stop()}},t,this)}));return function(e,r){return t.apply(this,arguments)}}()}]),e}();e.ProofOfWorkWebGl=y},function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}(r(25))}])});