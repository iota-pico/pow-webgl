!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("@iota-pico/core/dist/helpers/objectHelper"),require("@iota-pico/crypto/dist/error/cryptoError"),require("@iota-pico/core/dist/helpers/numberHelper"),require("@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"),require("@iota-pico/data/dist/data/trytes"),require("@iota-pico/crypto/dist/factories/spongeFactory"),require("@iota-pico/data/dist/data/trits")):"function"==typeof define&&define.amd?define("@iota-pico/pow-webgl",["@iota-pico/core/dist/helpers/objectHelper","@iota-pico/crypto/dist/error/cryptoError","@iota-pico/core/dist/helpers/numberHelper","@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase","@iota-pico/data/dist/data/trytes","@iota-pico/crypto/dist/factories/spongeFactory","@iota-pico/data/dist/data/trits"],e):"object"==typeof exports?exports["@iota-pico/pow-webgl"]=e(require("@iota-pico/core/dist/helpers/objectHelper"),require("@iota-pico/crypto/dist/error/cryptoError"),require("@iota-pico/core/dist/helpers/numberHelper"),require("@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"),require("@iota-pico/data/dist/data/trytes"),require("@iota-pico/crypto/dist/factories/spongeFactory"),require("@iota-pico/data/dist/data/trits")):t.IotaPicoPowWebgl=e(t["@iota-pico/core/dist/helpers/objectHelper"],t["@iota-pico/crypto/dist/error/cryptoError"],t["@iota-pico/core/dist/helpers/numberHelper"],t["@iota-pico/crypto/dist/proofOfWork/proofOfWorkBase"],t["@iota-pico/data/dist/data/trytes"],t["@iota-pico/crypto/dist/factories/spongeFactory"],t["@iota-pico/data/dist/data/trits"])}("undefined"!=typeof self?self:this,function(t,e,r,n,i,o,a){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)r.d(n,i,function(e){return t[e]}.bind(null,i));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=3)}([function(t,e,r){"use strict";r.r(e),r.d(e,"__extends",function(){return i}),r.d(e,"__assign",function(){return o}),r.d(e,"__rest",function(){return a}),r.d(e,"__decorate",function(){return c}),r.d(e,"__param",function(){return s}),r.d(e,"__metadata",function(){return _}),r.d(e,"__awaiter",function(){return u}),r.d(e,"__generator",function(){return f}),r.d(e,"__exportStar",function(){return h}),r.d(e,"__values",function(){return d}),r.d(e,"__read",function(){return l}),r.d(e,"__spread",function(){return p}),r.d(e,"__await",function(){return m}),r.d(e,"__asyncGenerator",function(){return y}),r.d(e,"__asyncDelegator",function(){return b}),r.d(e,"__asyncValues",function(){return x}),r.d(e,"__makeTemplateObject",function(){return v}),r.d(e,"__importStar",function(){return E}),r.d(e,"__importDefault",function(){return g});
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function i(t,e){function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var o=function(){return(o=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var i in e=arguments[r])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function a(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(t);i<n.length;i++)e.indexOf(n[i])<0&&(r[n[i]]=t[n[i]])}return r}function c(t,e,r,n){var i,o=arguments.length,a=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,r,n);else for(var c=t.length-1;c>=0;c--)(i=t[c])&&(a=(o<3?i(a):o>3?i(e,r,a):i(e,r))||a);return o>3&&a&&Object.defineProperty(e,r,a),a}function s(t,e){return function(r,n){e(r,n,t)}}function _(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}function u(t,e,r,n){return new(r||(r=Promise))(function(i,o){function a(t){try{s(n.next(t))}catch(t){o(t)}}function c(t){try{s(n.throw(t))}catch(t){o(t)}}function s(t){t.done?i(t.value):new r(function(e){e(t.value)}).then(a,c)}s((n=n.apply(t,e||[])).next())})}function f(t,e){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}}function h(t,e){for(var r in t)e.hasOwnProperty(r)||(e[r]=t[r])}function d(t){var e="function"==typeof Symbol&&t[Symbol.iterator],r=0;return e?e.call(t):{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}function l(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,i,o=r.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(n=o.next()).done;)a.push(n.value)}catch(t){i={error:t}}finally{try{n&&!n.done&&(r=o.return)&&r.call(o)}finally{if(i)throw i.error}}return a}function p(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(l(arguments[e]));return t}function m(t){return this instanceof m?(this.v=t,this):new m(t)}function y(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n,i=r.apply(t,e||[]),o=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(t){i[t]&&(n[t]=function(e){return new Promise(function(r,n){o.push([t,e,r,n])>1||c(t,e)})})}function c(t,e){try{!function(t){t.value instanceof m?Promise.resolve(t.value.v).then(s,_):u(o[0][2],t)}(i[t](e))}catch(t){u(o[0][3],t)}}function s(t){c("next",t)}function _(t){c("throw",t)}function u(t,e){t(e),o.shift(),o.length&&c(o[0][0],o[0][1])}}function b(t){var e,r;return e={},n("next"),n("throw",function(t){throw t}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(n,i){e[n]=t[n]?function(e){return(r=!r)?{value:m(t[n](e)),done:"return"===n}:i?i(e):e}:i}}function x(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t=d(t),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise(function(n,i){!function(t,e,r,n){Promise.resolve(n).then(function(e){t({value:e,done:r})},e)}(n,i,(e=t[r](e)).done,e.value)})}}}function v(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function E(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function g(t){return t&&t.__esModule?t:{default:t}}},function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0}),r(0).__exportStar(r(4),e)},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});const n=r(0),i=r(5),o=r(1),a=r(2),c=r(6),s=r(7),_=r(8);e.ProofOfWorkWebGl=class extends c.ProofOfWorkBase{constructor(t,e){super(e),o.ObjectHelper.isEmpty(t)?this._webGLPlatform={getWindow:()=>window,getDocument:t=>t.document,getCanvas:t=>t.createElement("canvas"),getWebGL:t=>t.getContext("webgl2",{alpha:!1,antialias:!1})}:this._webGLPlatform=t}initialize(){const t=t=>super[t];return n.__awaiter(this,void 0,void 0,function*(){return yield t("initialize").call(this),new Promise((t,e)=>{try{_.PearlDiver.initialize(this._webGLPlatform),this._isInitialized=!0,t()}catch(t){e(t)}})})}singlePow(t,e){return n.__awaiter(this,void 0,void 0,function*(){if(!this._isInitialized)throw new a.CryptoError("WebGL is not initialized, have you called initialize");if(!o.ObjectHelper.isType(t,s.Trytes))throw new a.CryptoError("The trytes must be an object of type Trytes");if(!i.NumberHelper.isInteger(e)||e<=0)throw new a.CryptoError("The minWeightMagnitude must be > 0");const r=yield _.PearlDiver.instance.searchWithTrytes(t,e),n=t.toString(),c=r.toString();return s.Trytes.fromString(n.substr(0,n.length-c.length).concat(c))})}}},function(t,e){t.exports=r},function(t,e){t.exports=n},function(t,e){t.exports=i},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});const n=r(0),i=r(1),o=r(9),a=r(10),c=n.__importDefault(r(11)),s=n.__importDefault(r(12)),_=n.__importDefault(r(13)),u=n.__importDefault(r(14)),f=n.__importDefault(r(15)),h=n.__importDefault(r(16)),d=n.__importDefault(r(17)),l=n.__importDefault(r(18)),p=n.__importDefault(r(19)),m=r(20),y=r(24);class b{constructor(t){this._webGLWorker=new m.WebGLWorker;const e=o.SpongeFactory.instance().create("curl");this._hashLength=e.getConstant("HASH_LENGTH"),this._stateLength=e.getConstant("STATE_LENGTH"),this._numberRounds=e.getConstant("NUMBER_OF_ROUNDS"),this._transactionLength=33*this._hashLength,this._nonceLength=this._hashLength/3,this._nonceStart=this._hashLength-this._nonceLength,this._webGLWorker.initialize(t,this._stateLength+1,b.TEXEL_SIZE),this._currentBuffer=this._webGLWorker.getIpt().data,this._webGLWorker.addProgram("init",h.default+c.default+l.default,"gr_offset"),this._webGLWorker.addProgram("increment",h.default+c.default+d.default),this._webGLWorker.addProgram("twist",h.default+p.default),this._webGLWorker.addProgram("check",h.default+_.default+u.default,"minWeightMagnitude"),this._webGLWorker.addProgram("col_check",h.default+s.default),this._webGLWorker.addProgram("finalize",h.default+_.default+f.default),this._state=y.PearlDiverState.ready,this._queue=[]}static initialize(t){b.instance||(b.instance=new b(t))}static closedown(){b.instance&&(b.instance=void 0)}searchWithTrytes(t,e){return n.__awaiter(this,void 0,void 0,function*(){const r=this.prepare(t);return this.search(r,e)})}prepare(t){const e=o.SpongeFactory.instance().create("curl");e.initialize();const r=a.Trits.fromTrytes(t).toArray();e.absorb(r,0,this._transactionLength-this._hashLength);const n=e.getState();return r.slice(this._transactionLength-this._hashLength,this._transactionLength).forEach((t,e)=>{n[e]=t}),this.searchToPair(n)}search(t,e){return n.__awaiter(this,void 0,void 0,function*(){return new Promise((r,n)=>{this._queue.push({states:t,minWeightMagnitude:e,callback:r}),this._state===y.PearlDiverState.ready&&this.searchDoNext()})})}searchToPair(t){const e={low:new Int32Array(this._stateLength),high:new Int32Array(this._stateLength)};return t.forEach((t,r)=>{switch(t){case 0:e.low[r]=b.HIGH_BITS,e.high[r]=b.HIGH_BITS;break;case 1:e.low[r]=b.LOW_BITS,e.high[r]=b.HIGH_BITS;break;default:e.low[r]=b.HIGH_BITS,e.high[r]=b.LOW_BITS}}),this.searchOffset(e,this._nonceStart),e}searchOffset(t,e){t.low[e+0]=b.LOW_0,t.low[e+1]=b.LOW_1,t.low[e+2]=b.LOW_2,t.low[e+3]=b.LOW_3,t.high[e+0]=b.HIGH_0,t.high[e+1]=b.HIGH_1,t.high[e+2]=b.HIGH_2,t.high[e+3]=b.HIGH_3}searchDoNext(){const t=this._queue.shift();i.ObjectHelper.isEmpty(t)?this._state=y.PearlDiverState.ready:(this._state=y.PearlDiverState.searching,this.webGLFindNonce(t))}webGLFindNonce(t){this.webGLWriteBuffers(t.states),this._webGLWorker.writeData(this._currentBuffer),this._webGLWorker.runProgram("init",1,{name:"gr_offset",value:0}),setTimeout(()=>this.webGLSearch(t),1)}webGLWriteBuffers(t){for(let e=0;e<this._stateLength;e++)this._currentBuffer[e*b.TEXEL_SIZE]=t.low[e],this._currentBuffer[e*b.TEXEL_SIZE+1]=t.high[e],this._currentBuffer[e*b.TEXEL_SIZE+2]=t.low[e],this._currentBuffer[e*b.TEXEL_SIZE+3]=t.high[e]}webGLSearch(t){if(this._webGLWorker.runProgram("increment",1),this._webGLWorker.runProgram("twist",this._numberRounds),this._webGLWorker.runProgram("check",1,{name:"minWeightMagnitude",value:t.minWeightMagnitude}),this._webGLWorker.runProgram("col_check",1),-1===this._webGLWorker.readData(this._stateLength,0,1,1)[2])setTimeout(()=>this.webGLSearch(t),10);else{this._webGLWorker.runProgram("finalize",1);const e=this._webGLWorker.readData(0,0,this._webGLWorker.getDimensions().x,1).reduce(this.pack(4),[]).slice(0,this._hashLength).map(t=>t[3]);t.callback(a.Trits.fromNumberArray(e).toTrytes()),this.searchDoNext()}}pack(t){return(e,r,n)=>(n%t==0?e.push([r]):e[e.length-1].push(r))&&e}}b.TEXEL_SIZE=4,b.LOW_BITS=0,b.HIGH_BITS=-1,b.LOW_0=3681400539,b.LOW_1=4059626622,b.LOW_2=2147475471,b.LOW_3=4290772992,b.HIGH_0=3067833782,b.HIGH_1=2412241905,b.HIGH_2=4290781183,b.HIGH_3=4194303,e.PearlDiver=b},function(t,e){t.exports=o},function(t,e){t.exports=a},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nint sum (int a, int b) {\n  int my_sum = a + b;\n  return my_sum == 2 ? -1 : (my_sum == -2) ? 1 : my_sum;\n}\nint cons (int a, int b) {\n  return (a == 1 && b == 1)? 1 : (a == -1 && b == -1) ? -1 : 0;\n}\nint any_t (int a, int b) {\n  int my_any = a + b;\n  return my_any == 0 ? 0 : (my_any > 0) ? 1 : -1;\n}\nivec2 full_adder(int a, int b, int c) {\n  int c_a, c_b, sum_ab, c_s;\n\n  c_a    = cons(a,b);\n  sum_ab = sum(a,b);\n  c_b    = cons(sum_ab,c);\n  c_s    = any_t(c_a, c_b);\n\n  return ivec2(sum(sum_ab, c), c_s);\n}\nivec2 get_sum_to_index(int from, int to, int number_to_add, int row) {\n  int trit_to_add, trit_at_index, pow, carry, num_carry;\n  ivec2 read_in, sum_out, out_trit;\n  pow = 1;\n  carry = 0;\n  num_carry = 0;\n\n  for(int i = from; i < to; i++) {\n    //if(trit_to_add == 0 && sum_out.t == 0) continue;\n\n    read_in = read_at ( ivec2 (i, row)).rg;\n\n    trit_to_add = ((number_to_add / pow) % 3) + num_carry;\n    num_carry = trit_to_add > 1 ? 1 : 0;\n    trit_to_add = (trit_to_add == 2 ? -1 : (trit_to_add == 3 ? 0 : trit_to_add));\n\n    sum_out = full_adder(\n      (read_in.s == LOW_BITS ? 1 : read_in.t == LOW_BITS? -1 : 0),\n      trit_to_add,\n      carry\n    );\n\n    if(my_coord.x == i) break;\n    carry = sum_out.t;\n    pow *=3;\n  }\n  if(sum_out.s == 0) {\n    return ivec2(HIGH_BITS);\n  } else if (sum_out.s == 1) {\n    return ivec2(LOW_BITS, HIGH_BITS);\n  } else {\n    return ivec2(HIGH_BITS, LOW_BITS);\n  }\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  int i;\n  if(my_coord.x == STATE_LENGTH && my_coord.y == 0) {\n    my_vec.b = 0;\n    if(my_vec.a == 0) {\n      ivec4 read_vec;\n      my_vec.b = -1;\n      for(i = 1; i < int(size.y); i++) {\n        read_vec = read_at( ivec2( STATE_LENGTH, i));\n        if(read_vec.a != 0) {\n          my_vec.a = read_vec.a;\n          my_vec.b = i;\n          break;\n        }\n      }\n    }\n  }\n  commit(my_vec);\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nint check(int row, int min_weight_magnitude) {\n  int nonce_probe, i;\n  ivec2 r_texel;\n  nonce_probe = HIGH_BITS;\n  for(i = min_weight_magnitude; i-- > 0; ) {\n    r_texel = read_at(ivec2(HASH_LENGTH - 1 - i, row)).ba;\n    nonce_probe &= ~(r_texel.s ^ r_texel.t);\n    if(nonce_probe == 0) break;\n  }\n  return nonce_probe;\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nuniform int minWeightMagnitude;\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x == STATE_LENGTH) {\n    my_vec.r = minWeightMagnitude;\n    my_vec.a = check(my_coord.y, minWeightMagnitude);\n  }\n  commit(my_vec);\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.y == 0 && my_coord.x == STATE_LENGTH) {\n    my_vec.g = check(my_vec.b, my_vec.r);\n  }\n  if(my_coord.y == 0 && my_coord.x < HASH_LENGTH) {\n    ivec4 info_vec = read_at(ivec2(STATE_LENGTH, 0));\n    int nonce_probe = info_vec.a;\n    int row = info_vec.b;\n    ivec4 hash_vec = read_at(ivec2(my_coord.x, row));\n    my_vec.a = (hash_vec.r & nonce_probe) == 0? 1 : ((hash_vec.g & nonce_probe) == 0? -1 : 0);\n  }\n  commit(my_vec);\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\n#define HASH_LENGTH 243\n#define NUMBER_OF_ROUNDS 81\n#define INCREMENT_START HASH_LENGTH - 64\n#define STATE_LENGTH 3 * HASH_LENGTH\n#define HALF_LENGTH 364\n#define HIGH_BITS 0xFFFFFFFF\n#define LOW_BITS 0x00000000\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x >= INCREMENT_START && my_coord.x < HASH_LENGTH ) {\n    my_vec.rg = get_sum_to_index(INCREMENT_START, HASH_LENGTH, 1, my_coord.y);\n  }\n  if(my_coord.x == STATE_LENGTH ) {\n    my_vec.rg = ivec2(0);\n  }\n  my_vec.ba = my_vec.rg;\n  commit(my_vec);\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nuniform int gr_offset;\nivec4 offset() {\n  if(my_coord.x >= HASH_LENGTH / 3 && my_coord.x < HASH_LENGTH / 3 * 2 ) {\n    ivec4 my_vec;\n    my_vec.rg = get_sum_to_index(HASH_LENGTH / 3, HASH_LENGTH / 3 * 2, my_coord.y + gr_offset, 0);\n    return my_vec;\n  } else {\n    return read_at(ivec2(my_coord.x,0));\n  }\n}\nvoid main() {\n  init();\n  commit(offset());\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="\nivec2 twist() {\n  int alpha, beta, gamma, delta;\n  ivec4 v1, v2;\n  int j = my_coord.x;\n\n  v1 = read_at(ivec2(j == 0? 0:(((j - 1)%2)+1)*HALF_LENGTH - ((j-1)>>1), my_coord.y));\n  v2 = read_at(ivec2(((j%2)+1)*HALF_LENGTH - ((j)>>1), my_coord.y));\n  alpha = v1.b;\n  beta = v1.a;\n  gamma = v2.a;\n  delta = (alpha | (~gamma)) & (v2.b ^ beta);//v2.b === state_low[t2]\n\n  return ivec2(~delta, (alpha ^ gamma) | delta);\n}\nvoid main() {\n  init();\n  ivec4 my_vec = read();\n  if(my_coord.x < STATE_LENGTH)\n    my_vec.ba = twist();\n  commit(my_vec);\n}\n"},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});const n=r(0),i=r(2),o=n.__importDefault(r(21)),a=n.__importDefault(r(22)),c=r(23);e.WebGLWorker=class{initialize(t,e,r){this._context=c.WebGLHelper.createContext(t),this._dimensions={x:e,y:0};const n=.5*Math.pow(this._context.MAX_TEXTURE_SIZE,2),i=Math.floor(n/this._dimensions.x/r)*this._dimensions.x*r;this._dimensions.y=i/this._dimensions.x/r,this._programs=new Map,this._ipt={data:new Int32Array(i),length:i},this._buffers={position:c.WebGLHelper.createBuffer(this._context,[-1,-1,1,-1,1,1,-1,1]),texture:c.WebGLHelper.createBuffer(this._context,[0,0,1,0,1,1,0,1]),index:c.WebGLHelper.createBuffer(this._context,[1,2,0,3,0,2],Uint16Array,this._context.ELEMENT_ARRAY_BUFFER)},this._attrib={position:0,texture:1},this._vertexArray=this._context.createVertexArray(),this._context.bindVertexArray(this._vertexArray),this.bindBuffers(),this._context.bindVertexArray(null),this.createVertexShader(),this._frameBuffer=this._context.createFramebuffer(),this._texture0=c.WebGLHelper.createTexture(this._context,this._ipt.data,this._dimensions),this._texture1=c.WebGLHelper.createTexture(this._context,new Int32Array(i),this._dimensions)}getDimensions(){return this._dimensions}getIpt(){return this._ipt}addProgram(t,e,...r){const n=this.createFragmentShader(e),i=this._context.createProgram();this._context.attachShader(i,this._vertexShader),this._context.attachShader(i,n),this._context.bindAttribLocation(i,this._attrib.position,"position"),this._context.bindAttribLocation(i,this._attrib.texture,"texture"),this._context.linkProgram(i);const o=new Map;for(const t of r)o.set(t,this._context.getUniformLocation(i,t));this._programs.set(t,{program:i,uniformVars:o})}runProgram(t,e,...r){const n=this._programs.get(t),o=n.program;if(!this._context.getProgramParameter(o,this._context.LINK_STATUS))throw new i.CryptoError("Failed to link GLSL program code");const a=n.uniformVars,s=this._context.getUniformLocation(o,"u_texture");this._context.useProgram(o);let _=e;for(;_-- >0;){this._context.bindTexture(this._context.TEXTURE_2D,this._texture0),this._context.activeTexture(this._context.TEXTURE0),this._context.uniform1i(s,0),this._context.viewport(0,0,this._dimensions.x,this._dimensions.y),c.WebGLHelper.frameBufferSetTexture(this._context,this._frameBuffer,this._texture1),this._context.bindVertexArray(this._vertexArray);for(const t of r)this._context.uniform1i(a.get(t.name),t.value);this._context.drawElements(this._context.TRIANGLES,6,this._context.UNSIGNED_SHORT,0);const t=this._texture0;this._texture0=this._texture1,this._texture1=t}this.finishRun()}readData(t,e,r,n){return this._context.bindFramebuffer(this._context.FRAMEBUFFER,this._frameBuffer),this._context.readPixels(t,e,r,n,this._context.RGBA_INTEGER,this._context.INT,this._ipt.data),this._context.bindFramebuffer(this._context.FRAMEBUFFER,null),this._ipt.data.subarray(0,this._ipt.length)}writeData(t){this._context.bindTexture(this._context.TEXTURE_2D,this._texture0),this._context.texImage2D(this._context.TEXTURE_2D,0,this._context.RGBA32I,this._dimensions.x,this._dimensions.y,0,this._context.RGBA_INTEGER,this._context.INT,t),this._context.bindTexture(this._context.TEXTURE_2D,null)}bindBuffers(){this._context.bindBuffer(this._context.ARRAY_BUFFER,this._buffers.texture),this._context.enableVertexAttribArray(this._attrib.texture),this._context.vertexAttribPointer(this._attrib.texture,2,this._context.FLOAT,!1,0,0),this._context.bindBuffer(this._context.ARRAY_BUFFER,this._buffers.position),this._context.enableVertexAttribArray(this._attrib.position),this._context.vertexAttribPointer(this._attrib.position,2,this._context.FLOAT,!1,0,0),this._context.bindBuffer(this._context.ELEMENT_ARRAY_BUFFER,this._buffers.index)}createVertexShader(){if(this._vertexShader=this._context.createShader(this._context.VERTEX_SHADER),this._context.shaderSource(this._vertexShader,a.default),this._context.compileShader(this._vertexShader),!this._context.getShaderParameter(this._vertexShader,this._context.COMPILE_STATUS))throw new i.CryptoError(`Could not build vertex shader.\n\n--- CODE DUMP ---${a.default}\n\n--- ERROR LOG ---\n${this._context.getShaderInfoLog(this._vertexShader)}`)}createFragmentShader(t){const e=this._context.createShader(this._context.FRAGMENT_SHADER);if(this._context.shaderSource(e,o.default+t),this._context.compileShader(e),!this._context.getShaderParameter(e,this._context.COMPILE_STATUS)){const r=t.split("\n");let n="Could not build fragment shader.\n\n------------------ KERNEL CODE DUMP ------------------\n";for(let t=0;t<r.length;t++)n+=`${o.default.split("\n").length+t}> ${r[t]}\n`;throw n+=`\n--------------------- ERROR  LOG ---------------------\n${this._context.getShaderInfoLog(e)}`,new i.CryptoError(n)}return e}finishRun(){this._context.bindVertexArray(null),this._context.bindTexture(this._context.TEXTURE_2D,null),this._context.bindFramebuffer(this._context.FRAMEBUFFER,null)}}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="#version 300 es\nprecision highp float;\nprecision highp int;\nprecision highp isampler2D;\nuniform isampler2D u_texture;\nin vec2 pos;\nout ivec4 color;\n//out int isFinished;\n\nvec2 size;\nivec2 my_coord;\n\nvoid init(void) {\n  //size = vec2(textureSize(u_texture, 0) - 1);\n  size = vec2(textureSize(u_texture, 0));\n  my_coord = ivec2(pos * size);\n}\n\nivec4 read(void) {\n  return texture(u_texture, pos);\n}\n\nivec4 read_at(ivec2 coord) {\n  return texelFetch(u_texture, coord, 0);\n}\n\nvoid commit(ivec4 val) {\n  color = val;\n}\n"},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default="#version 300 es\nlayout(location = 0) in vec2 position;\nlayout(location = 1) in vec2 texture;\nout vec2 pos;\n\nvoid main(void) {\n  pos = texture;\n  gl_Position = vec4(position.xy, 0.0, 1.0);\n}"},function(t,e,r){Object.defineProperty(e,"__esModule",{value:!0});const n=r(1),i=r(2);e.WebGLHelper=class{static createContext(t){const e=t.getWindow();if(n.ObjectHelper.isEmpty(e)||void 0===e)throw new i.CryptoError("window is not available, you must be running in an environment with WebGL.");{const r=t.getDocument(e);if(n.ObjectHelper.isEmpty(r))throw new i.CryptoError("window.document is not available, you must be running in an environment with WebGL.");{const o=t.getCanvas(r);if(n.ObjectHelper.isEmpty(o))throw new i.CryptoError("The HTML5 <canvas> element is not available in your browser.",{userAgent:e.navigator.userAgent});{const r=t.getWebGL(o);if(n.ObjectHelper.isEmpty(r))throw new i.CryptoError("Can not create a WebGL context on a <canvas> element.",{userAgent:e.navigator.userAgent});return r}}}}static createBuffer(t,e,r,n){const i=t.createBuffer();return t.bindBuffer(n||t.ARRAY_BUFFER,i),t.bufferData(n||t.ARRAY_BUFFER,new(r||Float32Array)(e),t.STATIC_DRAW),i}static createTexture(t,e,r){const n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA32I,r.x,r.y,0,t.RGBA_INTEGER,t.INT,e),t.bindTexture(t.TEXTURE_2D,null),n}static frameBufferSetTexture(t,e,r){if(t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.checkFramebufferStatus(t.FRAMEBUFFER)!==t.FRAMEBUFFER_COMPLETE)throw new i.CryptoError("Error attaching float texture to framebuffer. Your device is probably incompatible.")}}},function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.ready=0]="ready",t[t.searching=1]="searching",t[t.interrupted=-1]="interrupted"}(e.PearlDiverState||(e.PearlDiverState={}))}])});